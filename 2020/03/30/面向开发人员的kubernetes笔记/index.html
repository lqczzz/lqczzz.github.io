<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="面向开发人员的kubernetes笔记这边笔记涵盖了以下内容：  容器虚拟化的原理 容器编排的基本概念 k8s的容器编排对象 k8s的集群架构和基本原理 容器编排的实践  参考学习材料  《docker进阶与实战》 《kubernetes in action》ch1-ch11  极客时间《深入剖析Kubernetes》    容器&amp;amp;dockerdocker的虚拟化原理Namespace 做">
<meta property="og:type" content="article">
<meta property="og:title" content="面向开发人员的kubernetes笔记">
<meta property="og:url" content="http://lqczzz.github.io/2020/03/30/面向开发人员的kubernetes笔记/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="面向开发人员的kubernetes笔记这边笔记涵盖了以下内容：  容器虚拟化的原理 容器编排的基本概念 k8s的容器编排对象 k8s的集群架构和基本原理 容器编排的实践  参考学习材料  《docker进阶与实战》 《kubernetes in action》ch1-ch11  极客时间《深入剖析Kubernetes》    容器&amp;amp;dockerdocker的虚拟化原理Namespace 做">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200329213121557.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200329220457602.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200329221527443.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200329223022331.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200330003811291.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200330005629376.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200330005650536.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200330005740322.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200330010423544.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200402213710432.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200402213019107.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200402213121550.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200402213743308.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200402213913111.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200402213913111.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200329213556137.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200402223335663.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200402223352288.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200403011056624.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200402231301311.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200402231314698.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200402231908550.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200402232325392.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200402232551057.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200402234517386.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200402235448264.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200403000010564.png">
<meta property="og:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200403002417215.png">
<meta property="og:updated_time" content="2020-04-02T17:31:53.947Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="面向开发人员的kubernetes笔记">
<meta name="twitter:description" content="面向开发人员的kubernetes笔记这边笔记涵盖了以下内容：  容器虚拟化的原理 容器编排的基本概念 k8s的容器编排对象 k8s的集群架构和基本原理 容器编排的实践  参考学习材料  《docker进阶与实战》 《kubernetes in action》ch1-ch11  极客时间《深入剖析Kubernetes》    容器&amp;amp;dockerdocker的虚拟化原理Namespace 做">
<meta name="twitter:image" content="http://lqczzz.github.io/public/images/k8s_1/image-20200329213121557.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>面向开发人员的kubernetes笔记</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="https://github.com/lqczzz?tab=projects">项目</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/2019/11/20/对数据系统架构设计权衡的思考/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://lqczzz.github.io/2020/03/30/面向开发人员的kubernetes笔记/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://lqczzz.github.io/2020/03/30/面向开发人员的kubernetes笔记/&text=面向开发人员的kubernetes笔记"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://lqczzz.github.io/2020/03/30/面向开发人员的kubernetes笔记/&title=面向开发人员的kubernetes笔记"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://lqczzz.github.io/2020/03/30/面向开发人员的kubernetes笔记/&is_video=false&description=面向开发人员的kubernetes笔记"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=面向开发人员的kubernetes笔记&body=Check out this article: http://lqczzz.github.io/2020/03/30/面向开发人员的kubernetes笔记/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://lqczzz.github.io/2020/03/30/面向开发人员的kubernetes笔记/&title=面向开发人员的kubernetes笔记"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://lqczzz.github.io/2020/03/30/面向开发人员的kubernetes笔记/&title=面向开发人员的kubernetes笔记"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://lqczzz.github.io/2020/03/30/面向开发人员的kubernetes笔记/&title=面向开发人员的kubernetes笔记"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://lqczzz.github.io/2020/03/30/面向开发人员的kubernetes笔记/&title=面向开发人员的kubernetes笔记"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://lqczzz.github.io/2020/03/30/面向开发人员的kubernetes笔记/&name=面向开发人员的kubernetes笔记&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#面向开发人员的kubernetes笔记"><span class="toc-number">1.</span> <span class="toc-text">面向开发人员的kubernetes笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#容器-amp-docker"><span class="toc-number">1.1.</span> <span class="toc-text">容器&amp;docker</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#docker的虚拟化原理"><span class="toc-number">1.1.0.1.</span> <span class="toc-text">docker的虚拟化原理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Namespace-做隔离"><span class="toc-number">1.1.0.1.1.</span> <span class="toc-text">Namespace 做隔离</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Cgroups-做限制"><span class="toc-number">1.1.0.1.2.</span> <span class="toc-text">Cgroups 做限制</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#rootfs-做文件系统"><span class="toc-number">1.1.0.1.3.</span> <span class="toc-text">rootfs 做文件系统</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#容器编排-amp-kubernetes"><span class="toc-number">1.2.</span> <span class="toc-text">容器编排&amp;kubernetes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#什么是容器编排-Container-Orchestration）"><span class="toc-number">1.2.1.</span> <span class="toc-text">什么是容器编排(Container Orchestration）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kubernetes的集群架构"><span class="toc-number">1.2.2.</span> <span class="toc-text">kubernetes的集群架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kubernetes的资源对象"><span class="toc-number">1.2.3.</span> <span class="toc-text">kubernetes的资源对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-pod-最小的调度单位-workloads"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">1. pod - 最小的调度单位(workloads)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#pod的结构"><span class="toc-number">1.2.3.1.1.</span> <span class="toc-text">pod的结构</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#容器设计模式"><span class="toc-number">1.2.3.1.2.</span> <span class="toc-text">容器设计模式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pod的资源描述"><span class="toc-number">1.2.3.1.3.</span> <span class="toc-text">pod的资源描述</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-deployment-声明式的升级应用"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">2. deployment - 声明式的升级应用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#从replicationController-rc-说起"><span class="toc-number">1.2.3.2.1.</span> <span class="toc-text">从replicationController(rc)说起</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#deployment直接作用的是rs不是pod"><span class="toc-number">1.2.3.2.2.</span> <span class="toc-text">deployment直接作用的是rs不是pod</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#其他的编排对象"><span class="toc-number">1.2.3.2.3.</span> <span class="toc-text">其他的编排对象</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#其他编排方式：蓝绿-金丝雀-灰度-…"><span class="toc-number">1.2.3.2.4.</span> <span class="toc-text">其他编排方式：蓝绿/金丝雀(灰度)…</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-service-让客户端发现pod-amp-和pod通信"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">3. service - 让客户端发现pod&amp;和pod通信</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#服务发现"><span class="toc-number">1.2.3.3.1.</span> <span class="toc-text">服务发现</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#连接外部服务"><span class="toc-number">1.2.3.3.2.</span> <span class="toc-text">连接外部服务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#对外暴露服务"><span class="toc-number">1.2.3.3.3.</span> <span class="toc-text">对外暴露服务</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#nodeport"><span class="toc-number">1.2.3.3.3.1.</span> <span class="toc-text">nodeport</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#负载均衡器"><span class="toc-number">1.2.3.3.3.2.</span> <span class="toc-text">负载均衡器</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#ingress"><span class="toc-number">1.2.3.3.3.3.</span> <span class="toc-text">ingress</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#headless服务"><span class="toc-number">1.2.3.3.4.</span> <span class="toc-text">headless服务</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-volume-将磁盘挂在到pod中"><span class="toc-number">1.2.3.4.</span> <span class="toc-text">4. volume - 将磁盘挂在到pod中</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#常用volume"><span class="toc-number">1.2.3.4.1.</span> <span class="toc-text">常用volume</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#emptyDir"><span class="toc-number">1.2.3.4.1.1.</span> <span class="toc-text">emptyDir</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#hostPath"><span class="toc-number">1.2.3.4.1.2.</span> <span class="toc-text">hostPath</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#gitRepo"><span class="toc-number">1.2.3.4.1.3.</span> <span class="toc-text">gitRepo</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#persistence-volume"><span class="toc-number">1.2.3.4.2.</span> <span class="toc-text">persistence volume</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Projected-Volume"><span class="toc-number">1.2.3.4.3.</span> <span class="toc-text">Projected Volume</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#configmap"><span class="toc-number">1.2.3.4.3.1.</span> <span class="toc-text">configmap</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#secret"><span class="toc-number">1.2.3.4.3.2.</span> <span class="toc-text">secret</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#downward-api"><span class="toc-number">1.2.3.4.3.3.</span> <span class="toc-text">downward api</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#ServiceAccountToken"><span class="toc-number">1.2.3.4.3.4.</span> <span class="toc-text">ServiceAccountToken</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kubernetes运行原理"><span class="toc-number">1.2.4.</span> <span class="toc-text">kubernetes运行原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#组件"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">组件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-etcd-存储介质"><span class="toc-number">1.2.4.1.1.</span> <span class="toc-text">1) etcd - 存储介质</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-apiserver-k8s的api，类似系统调用之于于操作系统"><span class="toc-number">1.2.4.1.2.</span> <span class="toc-text">2) apiserver - k8s的api，类似系统调用之于于操作系统</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-调度器-分配节点"><span class="toc-number">1.2.4.1.3.</span> <span class="toc-text">3) 调度器 - 分配节点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-controller-manager-让集群状态向api定义的期望状态收敛"><span class="toc-number">1.2.4.1.4.</span> <span class="toc-text">4) controller manager - 让集群状态向api定义的期望状态收敛</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-kubelet"><span class="toc-number">1.2.4.1.5.</span> <span class="toc-text">5) kubelet</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6）kube-proxy"><span class="toc-number">1.2.4.1.6.</span> <span class="toc-text">6）kube-proxy</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#运行模式"><span class="toc-number">1.2.4.1.6.1.</span> <span class="toc-text">运行模式</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-插件"><span class="toc-number">1.2.4.1.7.</span> <span class="toc-text">7) 插件</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#控制器工作流"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">控制器工作流</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#跨pod网络-service-DNS-服务发现"><span class="toc-number">1.2.4.3.</span> <span class="toc-text">跨pod网络(service/DNS/服务发现)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-同一个pod内不同的容器通信"><span class="toc-number">1.2.4.3.1.</span> <span class="toc-text">1. 同一个pod内不同的容器通信</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-同一节点的通信原理（和docker的CNM一样"><span class="toc-number">1.2.4.3.2.</span> <span class="toc-text">2. 同一节点的通信原理（和docker的CNM一样</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#桥接网络模式"><span class="toc-number">1.2.4.3.2.1.</span> <span class="toc-text">桥接网络模式</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-跨节点的通信原理"><span class="toc-number">1.2.4.3.3.</span> <span class="toc-text">3. 跨节点的通信原理</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#UDP"><span class="toc-number">1.2.4.3.3.1.</span> <span class="toc-text">UDP</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#vxlan"><span class="toc-number">1.2.4.3.3.2.</span> <span class="toc-text">vxlan</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#host-gw"><span class="toc-number">1.2.4.3.3.3.</span> <span class="toc-text">host-gw</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常用kubectl的命令（持续更新"><span class="toc-number">1.3.</span> <span class="toc-text">常用kubectl的命令（持续更新</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#资源信息"><span class="toc-number">1.3.0.1.</span> <span class="toc-text">资源信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pod"><span class="toc-number">1.3.0.2.</span> <span class="toc-text">pod</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#pod-1"><span class="toc-number">1.3.0.2.0.1.</span> <span class="toc-text">pod</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#label"><span class="toc-number">1.3.0.2.0.2.</span> <span class="toc-text">label</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#namespace"><span class="toc-number">1.3.0.2.0.3.</span> <span class="toc-text">namespace</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        面向开发人员的kubernetes笔记
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Hexo</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-03-29T17:14:49.000Z" itemprop="datePublished">2020-03-30</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="面向开发人员的kubernetes笔记"><a href="#面向开发人员的kubernetes笔记" class="headerlink" title="面向开发人员的kubernetes笔记"></a>面向开发人员的kubernetes笔记</h1><p>这边笔记涵盖了以下内容：</p>
<ul>
<li>容器虚拟化的原理</li>
<li>容器编排的基本概念</li>
<li>k8s的容器编排对象</li>
<li>k8s的集群架构和基本原理</li>
<li>容器编排的实践</li>
</ul>
<p>参考学习材料</p>
<ul>
<li>《docker进阶与实战》</li>
<li><p>《kubernetes in action》ch1-ch11</p>
</li>
<li><p>极客时间《深入剖析Kubernetes》 </p>
</li>
</ul>
<h2 id="容器-amp-docker"><a href="#容器-amp-docker" class="headerlink" title="容器&amp;docker"></a>容器&amp;docker</h2><h4 id="docker的虚拟化原理"><a href="#docker的虚拟化原理" class="headerlink" title="docker的虚拟化原理"></a>docker的虚拟化原理</h4><p>Namespace 做隔离，Cgroups 做限制，rootfs 做文件系统</p>
<p>本质上依然是一个进程</p>
<h5 id="Namespace-做隔离"><a href="#Namespace-做隔离" class="headerlink" title="Namespace 做隔离"></a>Namespace 做隔离</h5><p>namespace用于对全局资源的隔离</p>
<p>已经有的：</p>
<ul>
<li>ipc</li>
<li>network</li>
<li>mount</li>
<li>pid</li>
<li>uts</li>
<li>user</li>
</ul>
<p>通常的操作：</p>
<p>clone： 创建新的namespance</p>
<p>setns：把进程放进已有的namespace里</p>
<h5 id="Cgroups-做限制"><a href="#Cgroups-做限制" class="headerlink" title="Cgroups 做限制"></a>Cgroups 做限制</h5><ul>
<li><p>cpuset子系统：限制可用的cpu列表</p>
</li>
<li><p>cpu子系统：限制cpu利用率</p>
</li>
<li><p>memory子系统：限制内存使用率</p>
</li>
<li><p>…</p>
</li>
</ul>
<h5 id="rootfs-做文件系统"><a href="#rootfs-做文件系统" class="headerlink" title="rootfs 做文件系统"></a>rootfs 做文件系统</h5><p>进程使用pivot_root系统调用来做跟文件系统的切换</p>
<p>（union mount来分层镜像）</p>
<h2 id="容器编排-amp-kubernetes"><a href="#容器编排-amp-kubernetes" class="headerlink" title="容器编排&amp;kubernetes"></a>容器编排&amp;kubernetes</h2><h3 id="什么是容器编排-Container-Orchestration）"><a href="#什么是容器编排-Container-Orchestration）" class="headerlink" title="什么是容器编排(Container Orchestration）"></a>什么是容器编排(Container Orchestration）</h3><p>容器编排是为了简化服务的开发和运维，提升基础设施利用率的工具。</p>
<p>容器编排核心关注的是以下几个点</p>
<ol>
<li><p>Workloads</p>
</li>
<li><p>Scheduler</p>
</li>
<li><p>Networking</p>
</li>
<li><p>Storage</p>
</li>
</ol>
<p>workloads是最小的部署单元，比如我们手动在服务器上启动web服务：<code>python manager runserver</code>,可以认为最小的部署单元是一个进程。workloads包含了network/memory/cpu等资源的需求。</p>
<p>scheduler主要功能有三个：</p>
<ul>
<li>控制着workloads的生命周期，包括创建，销毁，health check</li>
<li>控制着workloads之间的约束关系：Coordination/Replica/Dependency</li>
<li>workloads的扩容缩容/更新/回滚等</li>
</ul>
<p>Networks关注集群的网络模型（L3/L4)/DNS/service discovery/load balance</p>
<p>存储主要分为volumn &amp; persistence volumn</p>
<p>kubernetes是起源于google的borg&amp;omega的容器编排工具</p>
<p><img src="/public/images/k8s_1/image-20200329213121557.png" alt="image-20200329213121557"></p>
<h3 id="kubernetes的集群架构"><a href="#kubernetes的集群架构" class="headerlink" title="kubernetes的集群架构"></a>kubernetes的集群架构</h3><p>从硬件角度看，一个kubernetes集群有很多节点(node)组成，每个节点可以是物理机/虚拟机，这些节点被分为两种类型：</p>
<ul>
<li><p>master：集群的管理</p>
</li>
<li><p>worker：运行用户实际部署的应用</p>
</li>
</ul>
<p>  <img src="/public/images/k8s_1/image-20200329220457602.png" alt="image-20200329220457602"></p>
<p>master主要有四个组件</p>
<ul>
<li>etcd：提供线性一致性的存储，用于存储集群的配置信息/leader 选举</li>
<li>api server：etcd的代理，提供etcd的配置变更接口，变更监听的能力</li>
<li>scheduler：调度应用（给应用分配可部署的节点）</li>
<li>controller manager：跟踪工作节点，处理工作节点失效等集群的功能</li>
</ul>
<p>worker nodes主要有三个组件</p>
<ul>
<li><p>kubelet：管理节点的容器</p>
</li>
<li><p>kube-proxy：组件之间的负载均衡网络流量</p>
</li>
<li><p>Container runtime:容器运行时</p>
</li>
</ul>
<h3 id="kubernetes的资源对象"><a href="#kubernetes的资源对象" class="headerlink" title="kubernetes的资源对象"></a>kubernetes的资源对象</h3><p>kubernetes的资源对象包括了pod/deployment/service等等各种各样的资源。</p>
<p><img src="/public/images/k8s_1/image-20200329221527443.png" alt="image-20200329221527443"></p>
<p>kubernetes的资源对象都是通过yaml或者json描述文件来创建的，<code>kubebctl</code>也提供了一些简单的命令创建一组属性有限的资源对象。</p>
<h4 id="1-pod-最小的调度单位-workloads"><a href="#1-pod-最小的调度单位-workloads" class="headerlink" title="1. pod - 最小的调度单位(workloads)"></a>1. pod - 最小的调度单位(workloads)</h4><h5 id="pod的结构"><a href="#pod的结构" class="headerlink" title="pod的结构"></a>pod的结构</h5><p>kubernetes使用pod作为最小调度单位，pod是一组共享了某些资源的容器</p>
<p>具体的说，共享了net/uts/ipc/pid namespace，所以具有相同的loopback网络接口，可以进行ipc通信等，但是挂载文件系统是隔离的（文件系统来自于容器镜像）</p>
<p><img src="/public/images/k8s_1/image-20200329223022331.png" alt="image-20200329223022331"></p>
<ul>
<li>pod里的容器必须运行在相同的节点，解决了成组调度的问题</li>
<li>Infra 容器是一个非常特殊的镜像，叫作：k8s.gcr.io/pause。这个镜像是一个用汇编语言编写的、永远处于“暂停”状态的容器，解压后的大小也只有 100~200 KB 左右</li>
<li>pod之间的网络没有NAT转换</li>
<li>Pod 扮演的是传统部署环境里“虚拟机”的角色，调度、网络、存储，以及安全相关的属性，基本上是 Pod 级别的</li>
</ul>
<h5 id="容器设计模式"><a href="#容器设计模式" class="headerlink" title="容器设计模式"></a>容器设计模式</h5><p>主容器运行应用，sidecar进程运行住进程之外的工作</p>
<p>eg：</p>
<ul>
<li>war &amp;&amp; tomcat</li>
<li>应用和日志搜集</li>
<li>istio sidecar</li>
</ul>
<h5 id="pod的资源描述"><a href="#pod的资源描述" class="headerlink" title="pod的资源描述"></a>pod的资源描述</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1 # api版本</span><br><span class="line">kind: Pod # 资源类型</span><br><span class="line">metadata: # 名称/命名空间(namespace)/标签(label)</span><br><span class="line">  name: kubia-manual</span><br><span class="line">spec: # pod内容的实际说明，例如容器/volume等</span><br><span class="line">  containers:</span><br><span class="line">  - image: luksa/kubia</span><br><span class="line">    name: kubia</span><br><span class="line">    ports:</span><br><span class="line">    - containerPort: 8080</span><br><span class="line">      protocol: TCP</span><br><span class="line"># status: # status是运行时资源的状态</span><br></pre></td></tr></table></figure>
<ul>
<li><p>使用命名空间对资源进行分组(没有隔离作用)</p>
</li>
<li><p>使用标签和选择器来约束pod的调度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spec:</span><br><span class="line">	nodeSelector:</span><br><span class="line">		labelKey: labelValue</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-deployment-声明式的升级应用"><a href="#2-deployment-声明式的升级应用" class="headerlink" title="2. deployment - 声明式的升级应用"></a>2. deployment - 声明式的升级应用</h4><h5 id="从replicationController-rc-说起"><a href="#从replicationController-rc-说起" class="headerlink" title="从replicationController(rc)说起"></a>从replicationController(rc)说起</h5><p><img src="/public/images/k8s_1/image-20200330003811291.png" alt="image-20200330003811291"></p>
<p>通过给pod配置存活探针，kubernetes检测pod本身的状态</p>
<ul>
<li>当pod出现问题，replicationController会自动拉起一个新的pod</li>
<li>修改replicationController的replicas，可以实现动态扩容缩容</li>
<li>修改replicationController的template,可以升级应用(修改之后再删除原有的，因为修改template并不会影响现有的运行中的pod，这是一种停机升级)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: ReplicationController</span><br><span class="line">metadata:</span><br><span class="line">  name: kubia</span><br><span class="line">spec:</span><br><span class="line">  replicas: 3 # 副本数量</span><br><span class="line">  selector: # 根据label选择pod</span><br><span class="line">    app: kubia</span><br><span class="line">  template: # 声明被控制的对象（俄罗斯套娃</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: kubia</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: kubia</span><br><span class="line">        image: luksa/kubia</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 8080</span><br></pre></td></tr></table></figure>
<h5 id="deployment直接作用的是rs不是pod"><a href="#deployment直接作用的是rs不是pod" class="headerlink" title="deployment直接作用的是rs不是pod"></a>deployment直接作用的是rs不是pod</h5><p>replicationSet(rs)就是label选择表达式更加丰富了的rc。</p>
<p>没有deployment的时候，升级的应用的方式有：</p>
<ol>
<li>使用一个rc，停机升级：先修改template，删除旧pod，然后创建新的pod</li>
</ol>
<p><img src="/public/images/k8s_1/image-20200330005629376.png" alt="image-20200330005629376"></p>
<ol>
<li>使用两个rc，不停机升级：先修改template，删除旧pod，然后创建新的pod</li>
</ol>
<p><img src="/public/images/k8s_1/image-20200330005650536.png" alt="image-20200330005650536"></p>
<ol>
<li>手动执行滚动升级</li>
</ol>
<p><img src="/public/images/k8s_1/image-20200330005740322.png" alt="image-20200330005740322"></p>
<p>使用了deployment实现自动滚动升级(kubernetes自动控制)</p>
<p><img src="/public/images/k8s_1/image-20200330010423544.png" alt="image-20200330010423544"></p>
<ul>
<li>deployment滚动升级过程也是通过创建新的rs逐步替换旧pod，旧的rs不删除</li>
<li>保留旧的rs，方便回滚</li>
<li>支持暂停升级（相当于运行了一个金丝雀版本的app）</li>
</ul>
<h5 id="其他的编排对象"><a href="#其他的编排对象" class="headerlink" title="其他的编排对象"></a>其他的编排对象</h5><ul>
<li><p>daemon set： 给每个node都创建一个pod</p>
<p>eg：kube-proxy，日志搜集程序，servicemesh网格/sidecar</p>
</li>
<li><p>job:一次性任务/定时任务</p>
</li>
<li><p>stateful set：有状态的pods的编排对象</p>
</li>
</ul>
<h5 id="其他编排方式：蓝绿-金丝雀-灰度-…"><a href="#其他编排方式：蓝绿-金丝雀-灰度-…" class="headerlink" title="其他编排方式：蓝绿/金丝雀(灰度)…"></a>其他编排方式：蓝绿/金丝雀(灰度)…</h5><p><a href="https://github.com/ContainerSolutions/k8s-deployment-strategies" target="_blank" rel="noopener">https://github.com/ContainerSolutions/k8s-deployment-strategies</a></p>
<h4 id="3-service-让客户端发现pod-amp-和pod通信"><a href="#3-service-让客户端发现pod-amp-和pod通信" class="headerlink" title="3. service - 让客户端发现pod&amp;和pod通信"></a>3. service - 让客户端发现pod&amp;和pod通信</h4><p>service主要解决两个问题：</p>
<ol>
<li>pod随机调度引起的pod应用定位的问题</li>
<li>pod的流量的负载均衡</li>
</ol>
<p>service提供稳定的ip地址来访问pod</p>
<p>service的ip地址是虚拟ip地址(vip)，无法ping通</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: kubia</span><br><span class="line">spec:</span><br><span class="line">  ports: # 提供多个端口映射</span><br><span class="line">  - port: 80</span><br><span class="line">    targetPort: 8080</span><br><span class="line">  selector:</span><br><span class="line">    app: kubia</span><br></pre></td></tr></table></figure>
<h5 id="服务发现"><a href="#服务发现" class="headerlink" title="服务发现"></a>服务发现</h5><p>主要通过环境变量和DNS用于发现服务</p>
<ul>
<li><p>环境变量</p>
<p>XXX_SERVICE_HOST</p>
<p>XXX_SERVICE_PORT</p>
<p>(XXX为服务名字)</p>
</li>
<li><p>DNS</p>
<p>{service_name}.{namespace}.{可配置的集群域后缀}</p>
<p>eg：kubia.default.svc.cluster.local</p>
</li>
</ul>
<h5 id="连接外部服务"><a href="#连接外部服务" class="headerlink" title="连接外部服务"></a>连接外部服务</h5><p><img src="/public/images/k8s_1/image-20200402213710432.png" alt="image-20200402213710432"></p>
<p>连接service和pod的是一种叫做endpoint的资源，endpoint资源是一组服务的ip地址和端口列表</p>
<p>手动配置endpoint指向外部的ip/域名，可以使得服务得以访问相应的外部服务</p>
<h5 id="对外暴露服务"><a href="#对外暴露服务" class="headerlink" title="对外暴露服务"></a>对外暴露服务</h5><h6 id="nodeport"><a href="#nodeport" class="headerlink" title="nodeport"></a>nodeport</h6><p>把任意集群节点的端口的流量转发到内部的service ip端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: kubia-nodeport</span><br><span class="line">spec:</span><br><span class="line">  type: NodePort</span><br><span class="line">  ports:</span><br><span class="line">  - port: 80 # service 端口</span><br><span class="line">    targetPort: 8080 # pod容器端口</span><br><span class="line">    nodePort: 30123 # 集群的节点的端口</span><br><span class="line">  selector:</span><br><span class="line">    app: kubia</span><br></pre></td></tr></table></figure>
<p><img src="/public/images/k8s_1/image-20200402213019107.png" alt="image-20200402213019107"></p>
<h6 id="负载均衡器"><a href="#负载均衡器" class="headerlink" title="负载均衡器"></a>负载均衡器</h6><p>在nodeport基础上做了一层负载均衡</p>
<p><img src="/public/images/k8s_1/image-20200402213121550.png" alt="image-20200402213121550"></p>
<h6 id="ingress"><a href="#ingress" class="headerlink" title="ingress"></a>ingress</h6><p>ingress提供多个服务的负载均衡，本质上是k8s对反向代理的一种抽象(nginx/haproxy…)</p>
<p><img src="/public/images/k8s_1/image-20200402213743308.png" alt="image-20200402213743308"></p>
<p>ingress不转发请求给service，而是通过service来选择一个pod</p>
<p><img src="/public/images/k8s_1/image-20200402213913111.png" alt="image-20200402213913111"></p>
<h5 id="headless服务"><a href="#headless服务" class="headerlink" title="headless服务"></a>headless服务</h5><p>通过讲服务的spec配置项clusterIP设置为none，DNS查询不返回service的vip，而是返回多个A记录（每个pod一个）</p>
<h4 id="4-volume-将磁盘挂在到pod中"><a href="#4-volume-将磁盘挂在到pod中" class="headerlink" title="4. volume - 将磁盘挂在到pod中"></a>4. volume - 将磁盘挂在到pod中</h4><p>docker的文件系统来自于镜像，通过volume实现pod中多个容器的文件共享</p>
<h5 id="常用volume"><a href="#常用volume" class="headerlink" title="常用volume"></a>常用volume</h5><h6 id="emptyDir"><a href="#emptyDir" class="headerlink" title="emptyDir"></a>emptyDir</h6><p>磁盘临时文件，pod删除，卷内容会被回收</p>
<h6 id="hostPath"><a href="#hostPath" class="headerlink" title="hostPath"></a>hostPath</h6><p>挂载工作节点（host机器）上的文件，类似于shopee的日志</p>
<h6 id="gitRepo"><a href="#gitRepo" class="headerlink" title="gitRepo"></a>gitRepo</h6><p>git仓库同步的目录（不能一直保持同步）</p>
<h5 id="persistence-volume"><a href="#persistence-volume" class="headerlink" title="persistence volume"></a>persistence volume</h5><p>Pv/pvc/storage class</p>
<p>pvc：持久卷声明，面向用户(开发)，类似于接口。是用户需求清单的抽象</p>
<p>pv：持久卷，面向运维，类似实现了pvc的对象，运维可以随意替换存储介质的实现</p>
<p>storage class：实现了pvc的类，可以通过storage class模版化的生成pv</p>
<p><img src="/public/images/k8s_1/image-20200402213913111.png" alt="image-20200402215322964"></p>
<h5 id="Projected-Volume"><a href="#Projected-Volume" class="headerlink" title="Projected Volume"></a>Projected Volume</h5><p>常用配置应用程序的方式有：命令行参数/配置文件读取/环境变量读取。</p>
<p>projected volume是配置资源的抽象，但是最终让用户/应用进程所感知的方式同样是上面三种</p>
<p>抽象配置资源，可以独立配置声明的yaml文件和部署资源的yaml文件</p>
<h6 id="configmap"><a href="#configmap" class="headerlink" title="configmap"></a>configmap</h6><p>存储非敏感的文本配置数据</p>
<h6 id="secret"><a href="#secret" class="headerlink" title="secret"></a>secret</h6><p>用于传递证书/私钥之类的敏感数据</p>
<h6 id="downward-api"><a href="#downward-api" class="headerlink" title="downward api"></a>downward api</h6><p>用来和k8s通信/获取pod元数据的</p>
<h6 id="ServiceAccountToken"><a href="#ServiceAccountToken" class="headerlink" title="ServiceAccountToken"></a>ServiceAccountToken</h6><h3 id="kubernetes运行原理"><a href="#kubernetes运行原理" class="headerlink" title="kubernetes运行原理"></a>kubernetes运行原理</h3><h4 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h4><p><img src="/public/images/k8s_1/image-20200329213556137.png" alt="image-20200329213556137"></p>
<p>k8s组件主要分为：</p>
<ul>
<li>控制面板<ul>
<li>etcd</li>
<li>apiserver</li>
<li>scheduler</li>
<li>controller manager</li>
</ul>
</li>
<li>工作节点<ul>
<li>kubelet</li>
<li>kube-proxy</li>
<li>容器运行时</li>
</ul>
</li>
<li>附加组件<ul>
<li>K8s DNS服务器</li>
<li>dashboard</li>
<li>ingress控制器</li>
<li>集群监控</li>
<li>CNI（容器网络接口插件）</li>
</ul>
</li>
</ul>
<p>几个点：</p>
<ul>
<li>etcd是唯一的存储组件（raft协议，线性一致性的存储系统）</li>
<li>apiserver是唯一的和etcd交互的组件（apiserver实现了乐观锁机制，能保证冲突被正常处理）</li>
<li>apiserver以外的组件之间的通信都是通过apiserver进行</li>
<li>etcd和apiserver是多实例同时运行，其他组件虽然多实例，但只有一个主节点处于工作状态（利用etcd选举）</li>
<li>除了kubelet外，其他组件都可以作为pod来运行</li>
</ul>
<h5 id="1-etcd-存储介质"><a href="#1-etcd-存储介质" class="headerlink" title="1) etcd - 存储介质"></a>1) etcd - 存储介质</h5><h5 id="2-apiserver-k8s的api，类似系统调用之于于操作系统"><a href="#2-apiserver-k8s的api，类似系统调用之于于操作系统" class="headerlink" title="2) apiserver - k8s的api，类似系统调用之于于操作系统"></a>2) apiserver - k8s的api，类似系统调用之于于操作系统</h5><ol>
<li><p>集群资源和状态的crud</p>
<p><img src="/public/images/k8s_1/image-20200402223335663.png" alt="image-20200402223335663"></p>
</li>
<li><p>资源变更的通知</p>
</li>
</ol>
<p><img src="/public/images/k8s_1/image-20200402223352288.png" alt="image-20200402223352288"></p>
<h5 id="3-调度器-分配节点"><a href="#3-调度器-分配节点" class="headerlink" title="3) 调度器 - 分配节点"></a>3) 调度器 - 分配节点</h5><p>调度器调度流程：</p>
<ol>
<li>调度器监听api server中所有更新的pod的定义</li>
<li>选择一个合适的节点（涉及到调度策略）</li>
<li>更改pod中<code>nodeName</code>的声明</li>
<li>apiserver通知对应节点的kubelet</li>
<li>kubelet部署pod</li>
</ol>
<h5 id="4-controller-manager-让集群状态向api定义的期望状态收敛"><a href="#4-controller-manager-让集群状态向api定义的期望状态收敛" class="headerlink" title="4) controller manager - 让集群状态向api定义的期望状态收敛"></a>4) controller manager - 让集群状态向api定义的期望状态收敛</h5><p>控制器包括</p>
<ul>
<li>deployment controller</li>
<li>node controller</li>
<li>service controller</li>
<li>endpoints controller</li>
<li>namespace controller</li>
<li>…</li>
</ul>
<p>有些controller依赖外部组件，比如ingress controller，就是坚挺apiserver里ingress资源的变更，然后更新ingress的基础设施(nginx/haproxy等)的配置，动态修改配置，让集群的状态变成我们期待的状态（资源声明)</p>
<h5 id="5-kubelet"><a href="#5-kubelet" class="headerlink" title="5) kubelet"></a>5) kubelet</h5><p>主要工作有：</p>
<ol>
<li><p>注册node到apiserver</p>
</li>
<li><p>启动pod容器</p>
</li>
<li><p>持续监控容器，向apiserver报告</p>
</li>
</ol>
<h5 id="6）kube-proxy"><a href="#6）kube-proxy" class="headerlink" title="6）kube-proxy"></a>6）kube-proxy</h5><p>Cluster IP与NodePort等概念是kube-proxy服务通过iptables的NAT转换实现的，kube-proxy在运行过程中动态创建与Service相关的iptables规则，这些规则实现了将访问服务（Cluster IP或NodePort）的请求负载分发到后端Pod的功能</p>
<p><img src="/public/images/k8s_1/image-20200403011056624.png" alt="image-20200403011056624"></p>
<h6 id="运行模式"><a href="#运行模式" class="headerlink" title="运行模式"></a>运行模式</h6><p><img src="/public/images/k8s_1/image-20200402231301311.png" alt="image-20200402231301311"></p>
<p>最开始用于修改iptable规则，同时作为proxy组件代理请求进出，所以叫kube-proxy(性能差， 内核和用户态之间传输数据)</p>
<p><img src="/public/images/k8s_1/image-20200402231314698.png" alt="image-20200402231314698"></p>
<p>完全iptable模式，性能较高</p>
<h5 id="7-插件"><a href="#7-插件" class="headerlink" title="7) 插件"></a>7) 插件</h5><p>通过yaml声明，作为daemonset/deployment/replicationController资源部署</p>
<h4 id="控制器工作流"><a href="#控制器工作流" class="headerlink" title="控制器工作流"></a>控制器工作流</h4><p><img src="/public/images/k8s_1/image-20200402231908550.png" alt="image-20200402231908550"></p>
<p>所有组件执行动作的时候都会生成一个事件资源发送给apiserver，可以直接观测到</p>
<h4 id="跨pod网络-service-DNS-服务发现"><a href="#跨pod网络-service-DNS-服务发现" class="headerlink" title="跨pod网络(service/DNS/服务发现)"></a>跨pod网络(service/DNS/服务发现)</h4><p>k8s的网络的原则：</p>
<ol>
<li>每个pod具有唯一的ip</li>
<li>pod之间的通信没有NAT</li>
</ol>
<p><img src="/public/images/k8s_1/image-20200402232325392.png" alt="image-20200402232325392"></p>
<h5 id="1-同一个pod内不同的容器通信"><a href="#1-同一个pod内不同的容器通信" class="headerlink" title="1. 同一个pod内不同的容器通信"></a>1. 同一个pod内不同的容器通信</h5><p>同一个pod内的容器共享net namespace，共享协议栈，等同于在相同主机通信</p>
<h5 id="2-同一节点的通信原理（和docker的CNM一样"><a href="#2-同一节点的通信原理（和docker的CNM一样" class="headerlink" title="2. 同一节点的通信原理（和docker的CNM一样"></a>2. 同一节点的通信原理（和docker的CNM一样</h5><p><img src="/public/images/k8s_1/image-20200402232551057.png" alt="image-20200402232551057"></p>
<h6 id="桥接网络模式"><a href="#桥接网络模式" class="headerlink" title="桥接网络模式"></a>桥接网络模式</h6><p>Pod a ping pod b:</p>
<ol>
<li>ping进程构造ICMP echo请求包，并通过socket发给协议栈，</li>
<li>协议栈根据目的IP地址和系统路由表，知道去10.1.1.2的数据包应该要由10.1.1.1口出去</li>
<li>由于是第一次访问10.1.1.1，且目的IP和本地IP在同一个网段，所以协议栈会先发送ARP出去，询问10.1.1.1的mac地址</li>
<li>协议栈将ARP包交给eth0，让它发出去</li>
<li>由于eth0的另一端连的是veth123，所以ARP请求包就转发给了veth123</li>
<li>由于veth123的另一端连的是bridge，所以ARP请求包就转发给了bridge</li>
<li>arp包继续到达beth234和podb的eth0</li>
<li>eth0把arp包往上抛给协议栈，协议栈发现自己的设备有这个ip，返回arp应答（没有就抛弃</li>
</ol>
<p>ps：公司使用的是host网络（容器和宿主机具有相同的ip地址</p>
<h5 id="3-跨节点的通信原理"><a href="#3-跨节点的通信原理" class="headerlink" title="3. 跨节点的通信原理"></a>3. 跨节点的通信原理</h5><p><img src="/public/images/k8s_1/image-20200402234517386.png" alt="image-20200402234517386"></p>
<p>不同节点之间的网桥以某种形式连接</p>
<ul>
<li><p>三层网络</p>
</li>
<li><p>二层网络</p>
</li>
</ul>
<p>具体由CNI插件来实现</p>
<ul>
<li>calico</li>
<li>flannel<ul>
<li>udp</li>
<li>vxlan</li>
<li>Host-gw</li>
</ul>
</li>
</ul>
<h6 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h6><p><img src="/public/images/k8s_1/image-20200402235448264.png" alt="image-20200402235448264"></p>
<ul>
<li>Docker0（br）通过host机器上的路由表，转发请求到flannel0</li>
<li>flannel0是一个tun设备，把请求转发到用户空间的flanneld程序</li>
<li>flanneld查找etcd，找到目的容器ip对应的节点ip</li>
<li>套娃一层ip包</li>
<li>通过宿主机etho0转发udp包到公网</li>
<li>…</li>
</ul>
<h6 id="vxlan"><a href="#vxlan" class="headerlink" title="vxlan"></a>vxlan</h6><p><img src="/public/images/k8s_1/image-20200403000010564.png" alt="image-20200403000010564"></p>
<ul>
<li><p>在现有的三层网络之上，“覆盖”一层虚拟的、由内核 VXLAN 模块负责维护的二层网络，使得连接在这个 VXLAN 二层网络上的“主机”（虚拟机或者容器都可以）之间，可以像在同一个局域网（LAN）里那样自由通信</p>
</li>
<li><p>目的 VTEP 设备的arp表在节点创建的时候生成</p>
</li>
</ul>
<h6 id="host-gw"><a href="#host-gw" class="headerlink" title="host-gw"></a>host-gw</h6><p><img src="/public/images/k8s_1/image-20200403002417215.png" alt="image-20200403002417215"></p>
<ul>
<li>路径更短，性能更高</li>
<li>但是节点之间必须是二层联通的（通过路由表吓一跳mac地址设置目的地址，通过二层网络传输</li>
</ul>
<h2 id="常用kubectl的命令（持续更新"><a href="#常用kubectl的命令（持续更新" class="headerlink" title="常用kubectl的命令（持续更新"></a>常用kubectl的命令（持续更新</h2><h4 id="资源信息"><a href="#资源信息" class="headerlink" title="资源信息"></a>资源信息</h4><ol>
<li>kubectl explain po/ns …</li>
</ol>
<h4 id="pod"><a href="#pod" class="headerlink" title="pod"></a>pod</h4><h6 id="pod-1"><a href="#pod-1" class="headerlink" title="pod"></a>pod</h6><ol>
<li><p>创建pod - 通过yaml文件</p>
<p>kubectl create -f xxx.yaml</p>
</li>
<li><p>查看运行时pod的完整定义</p>
<p>kubectl get po poname -o yaml（-o 表示格式yaml/json）</p>
</li>
<li><p>查看pod日志</p>
<p>kubectl logs podname (只有一个容器时候)</p>
<p>kubectl logs podname -c containername (不只有一个容器时候)</p>
</li>
<li><p>本地ssh端口转发</p>
<p>kubectl port-forward podname localPort:podPort</p>
</li>
<li><p>删除pod</p>
<p>kubectl delete po podname</p>
<p>kubectl delete po -l labelKey=labelValue</p>
<p>kubectl delete ns nsName</p>
<p>kubectl delete po –all</p>
<p>kubectl delete all –all</p>
</li>
</ol>
<h6 id="label"><a href="#label" class="headerlink" title="label"></a>label</h6><ol>
<li>创建标签<ul>
<li>通过命令</li>
<li>通过yaml文件</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xxx</span><br><span class="line">metadata:</span><br><span class="line">	name: podname</span><br><span class="line">	labels:</span><br><span class="line">		labelkey: labelval</span><br></pre></td></tr></table></figure>
<ol>
<li><p>查看标签</p>
<ul>
<li>列表带标签</li>
</ul>
<p>kubectl get po –show-labels </p>
<p>Kubectl get po -L labelkey1，labelkey2</p>
<ul>
<li>通过标签过滤</li>
</ul>
<p>Kubectl get po -l labelkey</p>
<p>Kubectl get po -l labelkey=labelval</p>
<p>Kubectl get po -l labelkey=’!labelval’</p>
</li>
<li><p>修改标签</p>
<p>Kubectl label po podname labelkey=labbelval</p>
<p>Kubectl label po podname labelkey=labbelval –overwrite(修改已存在的)</p>
</li>
<li><p>使用标签分类工作节点</p>
<p>Kubectl label node codename labelkey=labelval</p>
</li>
<li><p>查看pod详细信息</p>
<p>Kubectl describe po podname</p>
</li>
<li><p>添加注解</p>
<p>Kubectl annotate pod podname key=value</p>
</li>
</ol>
<h6 id="namespace"><a href="#namespace" class="headerlink" title="namespace"></a>namespace</h6><ol>
<li><p>创建命名空间</p>
<ul>
<li>yaml</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Namespace</span><br><span class="line">metadata:</span><br><span class="line">  name: custom-ns</span><br></pre></td></tr></table></figure>
<ul>
<li><p>kubectl 方式:</p>
<p>kubectl create namespace custom-ns</p>
</li>
</ul>
</li>
<li><p>查看namespace</p>
<p>kubectl get ns</p>
</li>
<li><p>查看namespace中的所有pods</p>
<p>kubectl get po -n namespaceName</p>
</li>
</ol>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="https://github.com/lqczzz?tab=projects">项目</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#面向开发人员的kubernetes笔记"><span class="toc-number">1.</span> <span class="toc-text">面向开发人员的kubernetes笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#容器-amp-docker"><span class="toc-number">1.1.</span> <span class="toc-text">容器&amp;docker</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#docker的虚拟化原理"><span class="toc-number">1.1.0.1.</span> <span class="toc-text">docker的虚拟化原理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Namespace-做隔离"><span class="toc-number">1.1.0.1.1.</span> <span class="toc-text">Namespace 做隔离</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Cgroups-做限制"><span class="toc-number">1.1.0.1.2.</span> <span class="toc-text">Cgroups 做限制</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#rootfs-做文件系统"><span class="toc-number">1.1.0.1.3.</span> <span class="toc-text">rootfs 做文件系统</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#容器编排-amp-kubernetes"><span class="toc-number">1.2.</span> <span class="toc-text">容器编排&amp;kubernetes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#什么是容器编排-Container-Orchestration）"><span class="toc-number">1.2.1.</span> <span class="toc-text">什么是容器编排(Container Orchestration）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kubernetes的集群架构"><span class="toc-number">1.2.2.</span> <span class="toc-text">kubernetes的集群架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kubernetes的资源对象"><span class="toc-number">1.2.3.</span> <span class="toc-text">kubernetes的资源对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-pod-最小的调度单位-workloads"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">1. pod - 最小的调度单位(workloads)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#pod的结构"><span class="toc-number">1.2.3.1.1.</span> <span class="toc-text">pod的结构</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#容器设计模式"><span class="toc-number">1.2.3.1.2.</span> <span class="toc-text">容器设计模式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pod的资源描述"><span class="toc-number">1.2.3.1.3.</span> <span class="toc-text">pod的资源描述</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-deployment-声明式的升级应用"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">2. deployment - 声明式的升级应用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#从replicationController-rc-说起"><span class="toc-number">1.2.3.2.1.</span> <span class="toc-text">从replicationController(rc)说起</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#deployment直接作用的是rs不是pod"><span class="toc-number">1.2.3.2.2.</span> <span class="toc-text">deployment直接作用的是rs不是pod</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#其他的编排对象"><span class="toc-number">1.2.3.2.3.</span> <span class="toc-text">其他的编排对象</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#其他编排方式：蓝绿-金丝雀-灰度-…"><span class="toc-number">1.2.3.2.4.</span> <span class="toc-text">其他编排方式：蓝绿/金丝雀(灰度)…</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-service-让客户端发现pod-amp-和pod通信"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">3. service - 让客户端发现pod&amp;和pod通信</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#服务发现"><span class="toc-number">1.2.3.3.1.</span> <span class="toc-text">服务发现</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#连接外部服务"><span class="toc-number">1.2.3.3.2.</span> <span class="toc-text">连接外部服务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#对外暴露服务"><span class="toc-number">1.2.3.3.3.</span> <span class="toc-text">对外暴露服务</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#nodeport"><span class="toc-number">1.2.3.3.3.1.</span> <span class="toc-text">nodeport</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#负载均衡器"><span class="toc-number">1.2.3.3.3.2.</span> <span class="toc-text">负载均衡器</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#ingress"><span class="toc-number">1.2.3.3.3.3.</span> <span class="toc-text">ingress</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#headless服务"><span class="toc-number">1.2.3.3.4.</span> <span class="toc-text">headless服务</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-volume-将磁盘挂在到pod中"><span class="toc-number">1.2.3.4.</span> <span class="toc-text">4. volume - 将磁盘挂在到pod中</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#常用volume"><span class="toc-number">1.2.3.4.1.</span> <span class="toc-text">常用volume</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#emptyDir"><span class="toc-number">1.2.3.4.1.1.</span> <span class="toc-text">emptyDir</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#hostPath"><span class="toc-number">1.2.3.4.1.2.</span> <span class="toc-text">hostPath</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#gitRepo"><span class="toc-number">1.2.3.4.1.3.</span> <span class="toc-text">gitRepo</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#persistence-volume"><span class="toc-number">1.2.3.4.2.</span> <span class="toc-text">persistence volume</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Projected-Volume"><span class="toc-number">1.2.3.4.3.</span> <span class="toc-text">Projected Volume</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#configmap"><span class="toc-number">1.2.3.4.3.1.</span> <span class="toc-text">configmap</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#secret"><span class="toc-number">1.2.3.4.3.2.</span> <span class="toc-text">secret</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#downward-api"><span class="toc-number">1.2.3.4.3.3.</span> <span class="toc-text">downward api</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#ServiceAccountToken"><span class="toc-number">1.2.3.4.3.4.</span> <span class="toc-text">ServiceAccountToken</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kubernetes运行原理"><span class="toc-number">1.2.4.</span> <span class="toc-text">kubernetes运行原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#组件"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">组件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-etcd-存储介质"><span class="toc-number">1.2.4.1.1.</span> <span class="toc-text">1) etcd - 存储介质</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-apiserver-k8s的api，类似系统调用之于于操作系统"><span class="toc-number">1.2.4.1.2.</span> <span class="toc-text">2) apiserver - k8s的api，类似系统调用之于于操作系统</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-调度器-分配节点"><span class="toc-number">1.2.4.1.3.</span> <span class="toc-text">3) 调度器 - 分配节点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-controller-manager-让集群状态向api定义的期望状态收敛"><span class="toc-number">1.2.4.1.4.</span> <span class="toc-text">4) controller manager - 让集群状态向api定义的期望状态收敛</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-kubelet"><span class="toc-number">1.2.4.1.5.</span> <span class="toc-text">5) kubelet</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6）kube-proxy"><span class="toc-number">1.2.4.1.6.</span> <span class="toc-text">6）kube-proxy</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#运行模式"><span class="toc-number">1.2.4.1.6.1.</span> <span class="toc-text">运行模式</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-插件"><span class="toc-number">1.2.4.1.7.</span> <span class="toc-text">7) 插件</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#控制器工作流"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">控制器工作流</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#跨pod网络-service-DNS-服务发现"><span class="toc-number">1.2.4.3.</span> <span class="toc-text">跨pod网络(service/DNS/服务发现)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-同一个pod内不同的容器通信"><span class="toc-number">1.2.4.3.1.</span> <span class="toc-text">1. 同一个pod内不同的容器通信</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-同一节点的通信原理（和docker的CNM一样"><span class="toc-number">1.2.4.3.2.</span> <span class="toc-text">2. 同一节点的通信原理（和docker的CNM一样</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#桥接网络模式"><span class="toc-number">1.2.4.3.2.1.</span> <span class="toc-text">桥接网络模式</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-跨节点的通信原理"><span class="toc-number">1.2.4.3.3.</span> <span class="toc-text">3. 跨节点的通信原理</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#UDP"><span class="toc-number">1.2.4.3.3.1.</span> <span class="toc-text">UDP</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#vxlan"><span class="toc-number">1.2.4.3.3.2.</span> <span class="toc-text">vxlan</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#host-gw"><span class="toc-number">1.2.4.3.3.3.</span> <span class="toc-text">host-gw</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常用kubectl的命令（持续更新"><span class="toc-number">1.3.</span> <span class="toc-text">常用kubectl的命令（持续更新</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#资源信息"><span class="toc-number">1.3.0.1.</span> <span class="toc-text">资源信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pod"><span class="toc-number">1.3.0.2.</span> <span class="toc-text">pod</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#pod-1"><span class="toc-number">1.3.0.2.0.1.</span> <span class="toc-text">pod</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#label"><span class="toc-number">1.3.0.2.0.2.</span> <span class="toc-text">label</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#namespace"><span class="toc-number">1.3.0.2.0.3.</span> <span class="toc-text">namespace</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://lqczzz.github.io/2020/03/30/面向开发人员的kubernetes笔记/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://lqczzz.github.io/2020/03/30/面向开发人员的kubernetes笔记/&text=面向开发人员的kubernetes笔记"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://lqczzz.github.io/2020/03/30/面向开发人员的kubernetes笔记/&title=面向开发人员的kubernetes笔记"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://lqczzz.github.io/2020/03/30/面向开发人员的kubernetes笔记/&is_video=false&description=面向开发人员的kubernetes笔记"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=面向开发人员的kubernetes笔记&body=Check out this article: http://lqczzz.github.io/2020/03/30/面向开发人员的kubernetes笔记/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://lqczzz.github.io/2020/03/30/面向开发人员的kubernetes笔记/&title=面向开发人员的kubernetes笔记"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://lqczzz.github.io/2020/03/30/面向开发人员的kubernetes笔记/&title=面向开发人员的kubernetes笔记"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://lqczzz.github.io/2020/03/30/面向开发人员的kubernetes笔记/&title=面向开发人员的kubernetes笔记"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://lqczzz.github.io/2020/03/30/面向开发人员的kubernetes笔记/&title=面向开发人员的kubernetes笔记"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://lqczzz.github.io/2020/03/30/面向开发人员的kubernetes笔记/&name=面向开发人员的kubernetes笔记&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2020 lqczzz
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="https://github.com/lqczzz?tab=projects">项目</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

    <!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<!-- clipboard -->

  <script src="/lib/clipboard/clipboard.min.js"></script>
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code pre").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>

<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
